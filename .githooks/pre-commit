#!/bin/bash

# Git Pre-Commit Hook fÃ¼r KEI Agent Python SDK
# FÃ¼hrt automatisch Linting und Formatierung vor jedem Commit aus

set -e  # Exit bei Fehlern

# Farben fÃ¼r Output
RED='\033[0;31m'
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${BLUE}ğŸ” Pre-Commit Hook: FÃ¼hre Code-QualitÃ¤tsprÃ¼fungen aus...${NC}"

# PrÃ¼fe, ob make verfÃ¼gbar ist
if ! command -v make &> /dev/null; then
    echo -e "${RED}âŒ Fehler: 'make' ist nicht verfÃ¼gbar${NC}"
    exit 1
fi

# PrÃ¼fe, ob Makefile existiert
if [ ! -f "Makefile" ]; then
    echo -e "${RED}âŒ Fehler: Makefile nicht gefunden${NC}"
    exit 1
fi

echo -e "${BLUE}ğŸ“ FÃ¼hre 'make lint' aus...${NC}"

# FÃ¼hre make lint aus
if make lint; then
    echo -e "${GREEN}âœ… Linting und Formatierung erfolgreich!${NC}"
else
    echo -e "${RED}âŒ Linting fehlgeschlagen!${NC}"
    echo -e "${YELLOW}ğŸ’¡ Bitte behebe die Fehler und versuche den Commit erneut.${NC}"
    exit 1
fi

# PrÃ¼fe, ob Dateien durch Formatierung geÃ¤ndert wurden
if ! git diff --quiet; then
    echo -e "${YELLOW}âš ï¸  Dateien wurden durch Formatierung geÃ¤ndert.${NC}"
    echo -e "${YELLOW}ğŸ“ FÃ¼ge formatierte Dateien zum Commit hinzu...${NC}"
    
    # FÃ¼ge alle geÃ¤nderten Dateien zum Staging-Bereich hinzu
    git add -u
    
    echo -e "${GREEN}âœ… Formatierte Dateien wurden hinzugefÃ¼gt.${NC}"
fi

echo -e "${GREEN}ğŸ‰ Pre-Commit Hook erfolgreich abgeschlossen!${NC}"
echo -e "${GREEN}âœ… Commit kann fortgesetzt werden.${NC}"

exit 0
